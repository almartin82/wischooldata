---
title: "15 Insights from Wisconsin School Enrollment Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{15 Insights from Wisconsin School Enrollment Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 5,
  cache = TRUE
)
```

```{r load-packages}
library(wischooldata)
library(dplyr)
library(tidyr)
library(ggplot2)

theme_set(theme_minimal(base_size = 14))
```

This vignette explores Wisconsin's public school enrollment data, surfacing key trends and demographic patterns across the Badger State's school system.

---

## 1. Wisconsin educates nearly 850,000 students

Wisconsin public schools serve a substantial student population, with enrollment spread across urban centers and rural dairy country alike.

```{r statewide-data}
enr <- fetch_enr_multi(2018:2024, use_cache = TRUE)

state_totals <- enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students) |>
  mutate(change = n_students - lag(n_students),
         pct_change = round(change / lag(n_students) * 100, 2))

state_totals
```

```{r statewide-chart}
ggplot(state_totals, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#C5050C") +
  geom_point(size = 3, color = "#C5050C") +
  scale_y_continuous(labels = scales::comma, limits = c(0, NA)) +
  labs(
    title = "Wisconsin Public School Enrollment (2018-2024)",
    subtitle = "Tracking enrollment trends across the Badger State",
    x = "School Year (ending)",
    y = "Total Enrollment"
  )
```

---

## 2. Milwaukee dominates the enrollment landscape

Milwaukee Public Schools is by far the largest district, serving over 70,000 students---more than the next five districts combined.

```{r top-districts-data}
enr_2024 <- fetch_enr(2024, use_cache = TRUE)

top_10 <- enr_2024 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  arrange(desc(n_students)) |>
  head(10) |>
  select(district_name, n_students)

top_10
```

```{r top-districts-chart}
top_10 |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name)) +
  geom_col(fill = "#C5050C") +
  scale_x_continuous(labels = scales::comma) +
  labs(
    title = "Wisconsin's 10 Largest School Districts (2024)",
    x = "Total Enrollment",
    y = NULL
  )
```

---

## 3. Milwaukee's demographics differ sharply from the state

Milwaukee Public Schools is majority Black and Hispanic, while the state as a whole remains predominantly white---a stark urban-rural divide.

```{r demographics-data}
demographics <- enr_2024 |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("hispanic", "white", "black", "asian", "multiracial", "native_american")) |>
  mutate(pct = round(pct * 100, 1)) |>
  select(subgroup, n_students, pct) |>
  arrange(desc(n_students))

demographics
```

```{r demographics-chart}
demographics |>
  mutate(subgroup = forcats::fct_reorder(subgroup, n_students)) |>
  ggplot(aes(x = n_students, y = subgroup, fill = subgroup)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(pct, "%")), hjust = -0.1) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Wisconsin Student Demographics (2024)",
    subtitle = "Statewide racial/ethnic composition",
    x = "Number of Students",
    y = NULL
  )
```

---

## 4. Wisconsin's 12 CESAs organize regional services

Wisconsin divides into 12 Cooperative Educational Service Agencies (CESAs) that provide support services to districts. Enrollment varies widely by region.

```{r regional-data}
cesa_totals <- enr_2024 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         !is.na(cesa)) |>
  group_by(cesa) |>
  summarize(
    n_districts = n_distinct(district_id),
    total_students = sum(n_students, na.rm = TRUE),
    .groups = "drop"
  ) |>
  arrange(desc(total_students))

cesa_totals
```

```{r regional-chart}
cesa_totals |>
  mutate(cesa = forcats::fct_reorder(as.factor(cesa), total_students)) |>
  ggplot(aes(x = total_students, y = cesa)) +
  geom_col(fill = "#282728") +
  scale_x_continuous(labels = scales::comma) +
  labs(
    title = "Enrollment by CESA Region (2024)",
    subtitle = "Wisconsin's 12 Cooperative Educational Service Agencies",
    x = "Total Enrollment",
    y = "CESA"
  )
```

---

## 5. Suburban Madison and Milwaukee are growing

While Milwaukee Public Schools has declined, suburban districts like Waukesha, Elmbrook, and Madison Metropolitan have grown or held steady.

```{r growth-data}
growth <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         end_year %in% c(2018, 2024)) |>
  group_by(district_id, district_name) |>
  filter(n() == 2) |>
  summarize(
    y2018 = n_students[end_year == 2018],
    y2024 = n_students[end_year == 2024],
    pct_change = round((y2024 / y2018 - 1) * 100, 1),
    .groups = "drop"
  ) |>
  filter(y2018 > 5000) |>
  arrange(desc(pct_change)) |>
  head(10)

growth
```

```{r growth-chart}
growth |>
  mutate(district_name = forcats::fct_reorder(district_name, pct_change)) |>
  ggplot(aes(x = pct_change, y = district_name, fill = pct_change > 0)) +
  geom_col(show.legend = FALSE) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40") +
  scale_fill_manual(values = c("TRUE" = "#0479A8", "FALSE" = "#C5050C")) +
  labs(
    title = "Enrollment Change in Large Districts (2018-2024)",
    subtitle = "Districts with 5,000+ students in 2018",
    x = "Percent Change",
    y = NULL
  )
```

---

## 6. Milwaukee's enrollment has declined significantly

Milwaukee Public Schools has lost thousands of students over the past decade, driven by choice programs, charter schools, and population shifts.

```{r milwaukee-trend}
milwaukee <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Milwaukee", district_name, ignore.case = TRUE),
         !grepl("Suburban|Area", district_name, ignore.case = TRUE))

milwaukee_summary <- milwaukee |>
  select(end_year, district_name, n_students) |>
  arrange(district_name, end_year)

milwaukee_summary
```

```{r milwaukee-chart}
milwaukee_summary |>
  ggplot(aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#C5050C") +
  geom_point(size = 3, color = "#C5050C") +
  scale_y_continuous(labels = scales::comma, limits = c(0, NA)) +
  labs(
    title = "Milwaukee Public Schools Enrollment Decline",
    subtitle = "Annual enrollment 2018-2024",
    x = "School Year (ending)",
    y = "Total Enrollment"
  )
```

---

## 7. Wisconsin has a strong 4K (four-year-old kindergarten) program

Wisconsin's 4K program enrolls tens of thousands of four-year-olds, reflecting the state's investment in early childhood education.

```{r four-k}
grade_breakdown <- enr_2024 |>
  filter(is_state, subgroup == "total_enrollment",
         grade_level %in% c("PK4", "PK", "K", "01", "09", "12")) |>
  select(grade_level, n_students) |>
  arrange(match(grade_level, c("PK4", "PK", "K", "01", "09", "12")))

grade_breakdown
```

```{r grade-chart}
grade_breakdown |>
  mutate(grade_level = factor(grade_level, levels = c("PK4", "PK", "K", "01", "09", "12"))) |>
  ggplot(aes(x = grade_level, y = n_students, fill = grade_level == "PK4")) +
  geom_col(show.legend = FALSE) +
  scale_y_continuous(labels = scales::comma) +
  scale_fill_manual(values = c("TRUE" = "#C5050C", "FALSE" = "#282728")) +
  labs(
    title = "Wisconsin Enrollment by Grade Level (2024)",
    subtitle = "4K program highlighted in red",
    x = "Grade Level",
    y = "Number of Students"
  )
```

---

## 8. Rural dairy country districts are small but numerous

Wisconsin has hundreds of small rural districts, many in the state's famous dairy farming regions. Most have fewer than 1,000 students.

```{r small-districts}
size_distribution <- enr_2024 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  mutate(size_category = case_when(
    n_students < 500 ~ "Under 500",
    n_students < 1000 ~ "500-999",
    n_students < 2500 ~ "1,000-2,499",
    n_students < 5000 ~ "2,500-4,999",
    n_students < 10000 ~ "5,000-9,999",
    TRUE ~ "10,000+"
  )) |>
  mutate(size_category = factor(size_category,
    levels = c("Under 500", "500-999", "1,000-2,499", "2,500-4,999", "5,000-9,999", "10,000+"))) |>
  count(size_category) |>
  mutate(pct = round(n / sum(n) * 100, 1))

size_distribution
```

```{r size-chart}
size_distribution |>
  ggplot(aes(x = size_category, y = n, fill = size_category %in% c("Under 500", "500-999"))) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(n, " (", pct, "%)")), vjust = -0.3, size = 3.5) +
  scale_fill_manual(values = c("TRUE" = "#C5050C", "FALSE" = "#282728")) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(
    title = "Wisconsin Districts by Size (2024)",
    subtitle = "Small rural districts (under 1,000 students) highlighted",
    x = "District Size Category",
    y = "Number of Districts"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

---

## 9. Green Bay anchors northeastern Wisconsin

Green Bay Area Public Schools is the largest district in northeastern Wisconsin, serving the region's industrial and shipping hub.

```{r green-bay}
fox_valley <- enr_2024 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Green Bay|Appleton|Oshkosh|Fond du Lac", district_name, ignore.case = TRUE)) |>
  select(district_name, n_students) |>
  arrange(desc(n_students))

fox_valley
```

```{r fox-valley-chart}
fox_valley |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name, fill = grepl("Green Bay", district_name))) +
  geom_col(show.legend = FALSE) +
  scale_x_continuous(labels = scales::comma) +
  scale_fill_manual(values = c("TRUE" = "#203731", "FALSE" = "#FFB612")) +
  labs(
    title = "Northeastern Wisconsin's Largest Districts (2024)",
    subtitle = "Green Bay highlighted as regional anchor",
    x = "Total Enrollment",
    y = NULL
  )
```

---

## 10. Hispanic enrollment is growing statewide

Hispanic students are the fastest-growing demographic group in Wisconsin, particularly in southeastern Wisconsin and agricultural communities.

```{r hispanic-growth}
hispanic_trend <- enr |>
  filter(is_state, grade_level == "TOTAL", subgroup == "hispanic") |>
  select(end_year, n_students, pct) |>
  mutate(pct = round(pct * 100, 1))

hispanic_trend
```

```{r hispanic-chart}
hispanic_trend |>
  ggplot(aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#C5050C") +
  geom_point(size = 3, color = "#C5050C") +
  scale_y_continuous(labels = scales::comma, limits = c(0, NA)) +
  labs(
    title = "Hispanic Student Enrollment Growth in Wisconsin",
    subtitle = "Fastest-growing demographic group statewide",
    x = "School Year (ending)",
    y = "Hispanic Student Enrollment"
  )
```

---

## 11. The WOW Counties: Suburban Milwaukee's Demographic Mix

The WOW counties (Waukesha, Ozaukee, Washington) form an affluent suburban ring around Milwaukee with distinct demographic profiles---higher percentages of white students than the statewide average.

```{r wow-data}
# Identify WOW-area districts by name patterns
wow_districts <- enr_2024 |>
  filter(is_district, grade_level == "TOTAL",
         subgroup %in% c("total_enrollment", "white")) |>
  select(district_name, subgroup, n_students) |>
  pivot_wider(names_from = subgroup, values_from = n_students) |>
  filter(grepl("Waukesha|Germantown|Cedarburg|Mequon|Hartford|West Bend|Grafton|Slinger|Elmbrook|Kettle Moraine",
               district_name, ignore.case = TRUE)) |>
  mutate(pct_white = round(white / total_enrollment * 100, 1)) |>
  filter(total_enrollment > 1000) |>
  arrange(desc(pct_white))

wow_districts
```

```{r wow-chart}
wow_districts |>
  mutate(district_name = forcats::fct_reorder(district_name, pct_white)) |>
  ggplot(aes(x = pct_white, y = district_name)) +
  geom_col(fill = "#0479A8") +
  geom_vline(xintercept = 70, linetype = "dashed", color = "gray40") +
  annotate("text", x = 72, y = 1, label = "State avg ~70%", hjust = 0, size = 3) +
  labs(
    title = "White Student Percentage in WOW County Districts",
    subtitle = "Waukesha-Ozaukee-Washington suburban ring (districts >1,000 students)",
    x = "Percent White Students",
    y = NULL
  )
```

---

## 12. Special Education Enrollment Varies by Region

Special education rates differ markedly across Wisconsin, with some districts serving twice the proportion of students with disabilities as others.

```{r sped-data}
sped_rates <- enr_2024 |>
  filter(is_district, grade_level == "TOTAL",
         subgroup %in% c("total_enrollment", "special_ed")) |>
  select(district_name, subgroup, n_students) |>
  pivot_wider(names_from = subgroup, values_from = n_students) |>
  filter(total_enrollment > 2000) |>
  mutate(pct_sped = round(special_ed / total_enrollment * 100, 1)) |>
  arrange(desc(pct_sped))

sped_summary <- bind_rows(
  sped_rates |> head(5) |> mutate(group = "Highest"),
  sped_rates |> tail(5) |> mutate(group = "Lowest")
)

sped_summary
```

```{r sped-chart}
sped_summary |>
  mutate(district_name = forcats::fct_reorder(district_name, pct_sped)) |>
  ggplot(aes(x = pct_sped, y = district_name, fill = group)) +
  geom_col(show.legend = TRUE) +
  scale_fill_manual(values = c("Highest" = "#C5050C", "Lowest" = "#0479A8")) +
  labs(
    title = "Special Education Rates Vary Widely Across Wisconsin",
    subtitle = "Top 5 and bottom 5 districts with 2,000+ students",
    x = "Percent Special Education",
    y = NULL,
    fill = NULL
  )
```

---

## 13. Madison vs. Milwaukee: A Tale of Two Cities

Wisconsin's two largest cities have diverged dramatically. Milwaukee shrinks while Madison grows, reflecting broader economic and demographic shifts.

```{r two-cities-data}
two_cities <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Milwaukee Public|Madison Metropolitan", district_name, ignore.case = TRUE)) |>
  select(end_year, district_name, n_students)

two_cities
```

```{r two-cities-chart}
two_cities |>
  mutate(city = ifelse(grepl("Milwaukee", district_name), "Milwaukee", "Madison")) |>
  ggplot(aes(x = end_year, y = n_students, color = city)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 3) +
  scale_y_continuous(labels = scales::comma, limits = c(0, NA)) +
  scale_color_manual(values = c("Milwaukee" = "#C5050C", "Madison" = "#0479A8")) +
  labs(
    title = "Milwaukee vs. Madison Enrollment Trends",
    subtitle = "Wisconsin's two largest districts (2018-2024)",
    x = "School Year (ending)",
    y = "Total Enrollment",
    color = NULL
  )
```

---

## 14. English Learners Concentrated in Urban Areas

Limited English Proficiency (LEP) students are heavily concentrated in a handful of urban districts, with Milwaukee and Madison serving the vast majority.

```{r lep-data}
lep_districts <- enr_2024 |>
  filter(is_district, grade_level == "TOTAL",
         subgroup %in% c("total_enrollment", "lep")) |>
  select(district_name, subgroup, n_students) |>
  pivot_wider(names_from = subgroup, values_from = n_students) |>
  filter(lep > 200) |>
  mutate(pct_lep = round(lep / total_enrollment * 100, 1)) |>
  arrange(desc(lep)) |>
  head(10)

lep_districts
```

```{r lep-chart}
lep_districts |>
  mutate(district_name = forcats::fct_reorder(district_name, lep)) |>
  ggplot(aes(x = lep, y = district_name)) +
  geom_col(fill = "#282728") +
  geom_text(aes(label = paste0(pct_lep, "%")), hjust = -0.1, size = 3) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  labs(
    title = "Districts with Most English Learner Students (2024)",
    subtitle = "Top 10 districts by LEP enrollment (>200 students)",
    x = "Number of LEP Students",
    y = NULL
  )
```

---

## 15. The Driftless Region's Small School Districts

Southwestern Wisconsin's Driftless Area---unglaciated terrain known for dairy farms and winding valleys---is home to dozens of tiny school districts.

```{r driftless-data}
# Driftless region includes Crawford, Grant, Iowa, Lafayette, Richland, Vernon, and parts of others
driftless_districts <- enr_2024 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Prairie du Chien|Richland|Viroqua|Kickapoo|Westby|Cashton|La Farge|Hillsboro|Wonewoc|Necedah|Royall|Boscobel|Lancaster|Platteville|Fennimore|Potosi|Cassville|Seneca|River Ridge|Ithaca|Weston|De Soto|North Crawford|Riverdale|Pecatonica|Iowa-Grant|Highland|Mineral Point|Dodgeville",
               district_name, ignore.case = TRUE)) |>
  select(district_name, n_students) |>
  arrange(n_students)

driftless_districts
```

```{r driftless-chart}
driftless_districts |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name,
             fill = n_students < 500)) +
  geom_col(show.legend = FALSE) +
  scale_x_continuous(labels = scales::comma) +
  scale_fill_manual(values = c("TRUE" = "#C5050C", "FALSE" = "#282728")) +
  labs(
    title = "Driftless Region School Districts",
    subtitle = "Southwestern Wisconsin's small rural districts (under 500 highlighted)",
    x = "Total Enrollment",
    y = NULL
  )
```

---

## Summary

Wisconsin's school enrollment data reveals:

- **Urban-rural divide**: Milwaukee dominates enrollment but differs demographically from the rest of the state
- **Suburban growth**: Districts around Madison and Milwaukee are growing while the urban cores decline
- **Early childhood focus**: Wisconsin's 4K program shows commitment to early education
- **Small district heritage**: Hundreds of tiny rural districts serve dairy country communities
- **Demographic change**: Hispanic enrollment is growing, reshaping the state's student population
- **Suburban demographics**: WOW counties have distinct demographic profiles from urban cores
- **Service variation**: Special education and English learner rates vary significantly by region
- **Two cities diverge**: Madison grows while Milwaukee shrinks, reflecting broader economic forces

These patterns shape education policy across the Badger State.

---

*Data sourced from the Wisconsin Department of Public Instruction.*
